<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>components/TextEditor/Bullet/BaseBullet.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Collection.html">Collection</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Collection.html#closeCollection">closeCollection</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Collection.html#getSavedBullets">getSavedBullets</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Collection.html#openCollection">openCollection</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="DailyHabit.html">DailyHabit</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="DailyLogBullet.html">DailyLogBullet</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DailyLogBullet.html#initialiseBullet">initialiseBullet</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DailyLogBullet.html#keyDownListener">keyDownListener</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DailyLogBullet.html#serialize">serialize</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="EventWrapper.html">EventWrapper</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EventWrapper.html#getBulletTree">getBulletTree</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EventWrapper.html#getStorageKey">getStorageKey</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EventWrapper.html#initialise">initialise</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EventWrapper.html#render">render</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="JournalIcon.html">JournalIcon</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="module.html#.exports">exports</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Navbar.html">Navbar</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="SimpleBullet.html">SimpleBullet</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SimpleBullet.html#initialiseBullet">initialiseBullet</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SimpleBullet.html#serialize">serialize</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TaskBullet.html">TaskBullet</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TaskBullet.html#initialiseBullet">initialiseBullet</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TaskBullet.html#keyDownListener">keyDownListener</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TaskBullet.html#serialize">serialize</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Tracker.html">Tracker</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addCalendarDays">addCalendarDays</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#addClose">addClose</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addCollection">addCollection</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addCurrentDate">addCurrentDate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addFillerCircles">addFillerCircles</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#addForm">addForm</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addHabit">addHabit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#baseKeydownListener">baseKeydownListener</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#baseKeyupListener">baseKeyupListener</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#bulletModifiers">bulletModifiers</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#bulletTypes">bulletTypes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#clearContainerNode">clearContainerNode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#closeAddForm">closeAddForm</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#closeForm">closeForm</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createBullet">createBullet</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#DATE">DATE</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#deleteBullet">deleteBullet</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#deleteCollection">deleteCollection</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#deleteHabit">deleteHabit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#editColor">editColor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#exitSingleNesting">exitSingleNesting</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#flyoutMenu">flyoutMenu</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#focus">focus</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getDailyLogUID">getDailyLogUID</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getFirstDay">getFirstDay</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getFormattedDate">getFormattedDate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getHabits">getHabits</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getMonthDays">getMonthDays</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getMonthDaysLeap">getMonthDaysLeap</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getMonthlyLogUID">getMonthlyLogUID</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getMonthName">getMonthName</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getSavedBullets">getSavedBullets</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getTheme">getTheme</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getTitle">getTitle</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#hideMenu">hideMenu</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#initialiseBullet">initialiseBullet</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#menuButton">menuButton</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#navSpan">navSpan</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#nestBulletInside">nestBulletInside</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#nestCurrBullet">nestCurrBullet</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#openEditForm">openEditForm</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#openForm">openForm</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#populateEventWrappers">populateEventWrappers</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#removeHabit">removeHabit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#saveEvents">saveEvents</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#saveInputs">saveInputs</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#saveTasks">saveTasks</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#serialize">serialize</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setTaskEditor">setTaskEditor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#showMenu">showMenu</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#showSave">showSave</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#submitAdd">submitAdd</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#toggleHabit">toggleHabit</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#TOP_LEVEL_ORDER_ID">TOP_LEVEL_ORDER_ID</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#transferFocusTo">transferFocusTo</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">components/TextEditor/Bullet/BaseBullet.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const elementName = 'custom-bullet';
/**
 * The base class for a Bullet HTMLElement.
 */
export default class Bullet extends HTMLElement {
  constructor() {
    super();
    this.elementName = elementName;
    this.keysPressed = {};
    this.readOnly = false; // This is set to true if bullet must be read only

    this.bulletConfigs = {};
    this.bulletStyle = ''; // This is default style
    this.uniqueID = 0;
    this.getNextID = () => console.error('Bullet.getNextID is not setup');
    this.updateCallbacks = {};
    this.getAdjacentBullet = () => console.error('Bullet.getAdjacentBullet is not set');
  }

  /**
   * Initialises bullet attributes
   * @param {*} bulletAttributes
   * @param {Object} bulletAttributes.updateCallbacks
   * @param {function} bulletAttributes.getNextID
   * @param {function} bulletAttributes.getAdjacentBullet
   * @param {number} [ bulletAttributes.uniqueID ]
   * @param {string} [ bulletAttributes.bulletStyle ]
   * @param {Object} [ bulletAttributes.bulletConfigs ]
   */
  initialiseBullet(bulletAttributes) {
    this.bulletConfigs = bulletAttributes.bulletConfigs;
    if ('readOnly' in this.bulletConfigs) {
      this.readOnly = this.bulletConfigs.readOnly;
      this.shadowRoot.querySelector('input[type=text]').readOnly = this.readOnly;
    }
    this.updateCallbacks = bulletAttributes.updateCallbacks;
    this.getNextID = bulletAttributes.getNextID;
    this.getAdjacentBullet = bulletAttributes.getAdjacentBullet;

    this.uniqueID = ('uniqueID' in bulletAttributes) ? bulletAttributes.uniqueID : this.getNextID();

    this.shadowRoot.querySelector('input').value = this.state.value;
    this.shadowRoot.querySelector('style').innerHTML = this.bulletStyle;
  }

  /**
   * Turn contents of bullet into an easily accessible format.
   *
   * Must be overriden by developer in extension of Bullet class.
   */
  serialize() {
    console.error(`serialize() not implemented for ${this.elementName}`);
  }

  // Setters
  setNestDepthRem(nestDepthRem) {
    this.state.nestDepthRem = nestDepthRem;
  }

  // Getters
  getValue() {
    return this.state.value;
  }

  getNestDepthRem() {
    return this.state.nestDepthRem;
  }

  getUniqueID() {
    return this.uniqueID;
  }

  getParentBullet() {
    return this.getRootNode().host;
  }

  // Mutators
  /**
   * Resets key watcher and smoothly transfers focus to `bullet`
   * @param {Bullet} bullet - Bullet to transfer functionality to
   */
  transferFocusTo(bullet) {
    this.keysPressed = {};
    bullet.focus();
  }

  /**
   * Nests `bullet` inside `this` bullet
   * @param {Bullet} bullet - Bullet to be nested
   */
  nestBulletInside(bullet) {
    this.shadowRoot.querySelector('.nested').appendChild(bullet);
    bullet.setNestDepthRem(this.getNestDepthRem() - 1);
  }

  /**
   * Sets focus to `input` field of `this` Bullet
   */
  focus() {
    const inputField = this.shadowRoot.querySelector('input');
    inputField.focus();
  }

  /**
   * Takes `this` bullet and nests it into the sibling bullet above the current one.
   */
  nestCurrBullet() {
    const prevBullet = this.previousElementSibling;
    if (prevBullet == null) return;
    if (this.getNestDepthRem() &lt;= 0) return;
    prevBullet.nestBulletInside(this);
    this.updateCallbacks.nestCurrBullet(this.uniqueID, prevBullet.uniqueID, true);
    this.transferFocusTo(this); // Reset focus
  }

  /**
   * Creates a bullet underneath the current one as a sibling.
   */
  createBullet() {
    const newBullet = document.createElement(this.elementName);
    newBullet.initialiseBullet({
      updateCallbacks: this.updateCallbacks,
      getNextID: this.getNextID,
      getAdjacentBullet: this.getAdjacentBullet,
      bulletStyle: this.bulletStyle,
      bulletConfigs: this.bulletConfigs,
    });

    this.updateCallbacks.createBullet(this.uniqueID, newBullet);

    newBullet.setNestDepthRem(this.getNestDepthRem());

    this.after(newBullet);
    this.transferFocusTo(newBullet);
  }

  /**
   * Takes this bullet and moves it out of one level of nesting.
   *
   * @param {*} e The event activated by tapping the keys to exit nesting.
   */
  exitSingleNesting(e) {
    const parentBullet = e.target.getRootNode().host.getParentBullet();
    if ((parentBullet === undefined) || (parentBullet.tagName !== this.elementName.toUpperCase())) {
      console.log('No levels of nesting found');
      return;
    }
    parentBullet.after(this);
    this.setNestDepthRem(this.getNestDepthRem() + 1);

    const grandParentBullet = parentBullet.getParentBullet();
    let grandParentID;
    if (grandParentBullet === undefined) grandParentID = null;
    else {
      grandParentID = (
        grandParentBullet.tagName === this.elementName.toUpperCase()
      ) ? grandParentBullet.uniqueID : null;
    }

    this.updateCallbacks.nestCurrBullet(this.uniqueID, grandParentID, false);
    this.focus(); // Reset focus
  }

  /**
   * Deletes this bullet.
   */
  deleteBullet() {
    let nextFocusBullet = this.getAdjacentBullet(this.uniqueID, true);
    if (nextFocusBullet === null) nextFocusBullet = this.getAdjacentBullet(this.uniqueID, false);
    const allowDelete = this.updateCallbacks.deleteBullet(this.uniqueID);
    if (allowDelete) {
      if (nextFocusBullet !== null) this.transferFocusTo(nextFocusBullet);
      this.remove();
    }
  }

  /**
   * Keydown keyboard Listeners. Must be called on the `input` element in the DOM
   *
   * Shortcuts being checked (in order):
   * 1. Shift + Tab
   * 2. Tab
   * 3. Control + s
   * 4. ArrowUp
   * 5. ArrowDown
   *
   * @param {*} e
   * @returns {Boolean} true if a shortcut was matched, false otherwise
   */
  baseKeydownListener(e) {
    if (!this.readOnly &amp;&amp; this.keysPressed.Shift &amp;&amp; this.keysPressed.Tab) {
      e.preventDefault();
      this.exitSingleNesting(e);
    } else if (!this.readOnly &amp;&amp; this.keysPressed.Tab) {
      e.preventDefault();
      this.nestCurrBullet();
    } else if (this.keysPressed.Control &amp;&amp; this.keysPressed.s) {
      e.preventDefault();
      this.updateCallbacks.saveData();
    } else if (this.keysPressed.ArrowUp) {
      const nextBullet = this.getAdjacentBullet(this.uniqueID, true);
      if (nextBullet !== null) this.transferFocusTo(nextBullet);
    } else if (this.keysPressed.ArrowDown) {
      const nextBullet = this.getAdjacentBullet(this.uniqueID, false);
      if (nextBullet !== null) this.transferFocusTo(nextBullet);
    } else {
      return false;
    }
    return true;
  }

  /**
   * Keyup keyboard Listeners. Must be called on the `input` element in the DOM
   *
   * Shortcuts being checked (in order):
   * 1. Enter
   * 2. Backspace
   *
   * @param {*} e
   * @returns {Boolean} true if a shortcut was matched, false otherwise
   */
  baseKeyupListener() {
    if (!this.readOnly &amp;&amp; this.keysPressed.Enter) {
      if (this.state.value === '') return true;
      this.createBullet();
    } else if (!this.readOnly &amp;&amp; this.keysPressed.Backspace &amp;&amp; this.getValue() === '') {
      this.deleteBullet();
    } else {
      return false;
    }
    return true;
  }
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Fri Jun 11 2021 04:12:26 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
